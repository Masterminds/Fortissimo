<?xml version="1.0"?>
<project name="Fortissimo" 
  description="Create a new Fortissimo application"
  basedir="." 
  default="main"
>
<!--
This is the master fortissimo builder.

Copyright (c) 2009, Matt Butcher, some rights reserved.
-->

  <property name="project" value="FORTISSIMO"/>
  <property name="basepath" value="${application.startdir}"/>
  <property name="origindir" value="."/>
  <property name="srcdir" value="./src"/>
  <property name="docsdir" value="${origindir}/doc"/>
  
  <fileset id="skeleton" dir="${origindir}/Fortissimo/skel">
    <include name="**"/>
  </fileset>

  <!-- Files that must be included in the release -->
  <fileset id="licensefiles" dir=".">
    <include name="README"/>
    <include name="INSTALL"/>
  </fileset>

  <!-- Files to be treated as source code -->
  <fileset id="sourcecode" dir="">
    <include name="**/*" />
  </fileset>

  <!-- Main Target -->
  <target name="main" description="main target">
    <echo>The Fortissimo Framework Builder. Use fff.php to run this script.</echo>
  </target>
  
  <!-- TEST -->
  <target name="test" description="Test target.">
    <echo>This is a test target</echo>
    <echo>Origin: ${origindir}</echo>
    <echo>Project: ${basepath}/${project}</echo>
    <echo>Base Dir: ${basepath}</echo>
  </target>
  
  <!-- Create a new project -->
  <target name="newProject" description="Create a new project">
    <!-- Create the project -->
    <mkdir dir="${basepath}/${project}"/>
    
    <!-- Copy in the base files -->
    <copy todir="${basepath}/${project}">
      <fileset refid="skeleton"/>
      <fileset refid="licensefiles"/>
    </copy>
    
    <!-- Copy the base API docs. -->
    <mkdir dir="${basepath}/${project}/doc/Fortissimo"/>
    <copy todir="${basepath}/${project}/doc/Fortissimo">
      <fileset dir="${docsdir}">
        <include pattern="api/**"/>
        <include pattern="Overview.txt"/>
      </fileset>
    </copy>
    
    <!-- Clean up core Fortissimo tools -->
    <reflexive>
      <fileset dir="${basepath}/${project}/src">
        <!-- Right now, we just compress Fortissimo. -->
        <include pattern="Fortissimo.php"/>
      </fileset>
      <filterchain>
        <stripwhitespace/>
        <stripphpcomments/>
      </filterchain>
    </reflexive>
    
    <!-- Move _htaccess to .htaccess -->
    <move file="${basepath}/${project}/src/_htaccess" 
      toFile="${basepath}/${project}/src/.htaccess" overwrite="false"/>
  </target>
</project>